<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=3.0">
    <title>Petanque Matchprotokoll</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #2c5545;
            text-align: center;
            border-bottom: 2px solid #2c5545;
            padding-bottom: 10px;
        }
        .match-info {
            background-color: #f5f9f7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .team-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 20px;
        }
        .team {
            flex: 1;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        /* Optimera kolumnbredd */
        table th:first-child, 
        table td:first-child {
            width: 40px; /* Ännu mindre omgångskolumn */
            padding: 2px;
            font-size: 12px;
        }
        
        table th:nth-child(2), 
        table td:nth-child(2),
        table th:nth-child(3), 
        table td:nth-child(3) {
            width: 90px; /* Mer plats för poängkolumnerna */
            padding: 8px;
        }
        
        table th:nth-child(4), 
        table td:nth-child(4) {
            width: auto; /* Notiskolumn tar resterande plats */
            min-width: 120px;
        }
        .round-note {
            width: 100%;
            border: 1px solid #ccc;
            padding: 4px;
            font-size: 12px;
            text-align: left;
            min-height: 20px;
            box-sizing: border-box;
        }
        .round-note:focus {
            border-color: #2c5545;
            outline: none;
        }
        
        /* Bättre touch targets för mobil */
        input, select, textarea, button {
            -webkit-appearance: none;
            appearance: none;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        th {
            background-color: #2c5545;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .summary {
            background-color: #e9f5f0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        button {
            background-color: #2c5545;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #3a6b58;
        }
        
        .save-section {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #b3d9ff;
        }
        
        .save-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .save-buttons button {
            flex: 1;
            min-width: 150px;
            margin: 0;
        }
        
        .saved-matches {
            background-color: #fff8dc;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #f0e68c;
        }
        
        .match-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #ddd;
        }
        
        .match-info-text {
            flex: 1;
            font-size: 14px;
        }
        
        .match-actions {
            display: flex;
            gap: 5px;
        }
        
        .small-btn {
            padding: 5px 10px;
            font-size: 12px;
            min-width: auto;
        }
        
        .load-btn {
            background-color: #28a745;
        }
        
        .load-btn:hover {
            background-color: #218838;
        }
        
        .delete-btn {
            background-color: #dc3545;
        }
        
        .delete-btn:hover {
            background-color: #c82333;
        }
        
        @media print {
            button, .save-section, .saved-matches {
                display: none;
            }
        }
        
        /* Mobilanpassning */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 14px;
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
            
            .team-section {
                flex-direction: column;
                gap: 15px;
            }
            
            .match-info > div {
                flex-direction: column;
                gap: 10px;
            }
            
            .match-info > div > div {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .match-info label {
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .match-info input, .match-info select {
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }
            
            /* Mobilanpassad tabell */
            table {
                font-size: 12px;
                margin: 10px 0;
            }
            
            th, td {
                padding: 4px 2px;
                vertical-align: top;
            }
            
            /* Ännu mer kompakt på mobil */
            table th:first-child, 
            table td:first-child {
                width: 25px; /* Extra liten omgångskolumn på mobil */
                padding: 1px;
                font-size: 10px;
            }
            
            table th:nth-child(2), 
            table td:nth-child(2),
            table th:nth-child(3), 
            table td:nth-child(3) {
                width: 65px; /* Mer plats för poäng på mobil */
                padding: 4px 2px;
            }
            
            table th:nth-child(4), 
            table td:nth-child(4) {
                min-width: 100px;
            }
            
            .score-input {
                width: 40px;
                padding: 2px;
                font-size: 12px;
                text-align: center;
            }
            
            .round-note {
                width: 100%;
                padding: 3px;
                font-size: 10px;
                min-height: 30px;
            }
            
            /* Kompaktare knappar på mobil */
            button {
                width: 100%;
                margin-bottom: 10px;
                padding: 12px;
                font-size: 14px;
            }
            
            .save-buttons {
                flex-direction: column;
            }
            
            .save-buttons button {
                width: 100%;
                margin-bottom: 8px;
            }
            
            .match-item {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .match-actions {
                justify-content: center;
            }
            
            .summary {
                padding: 10px;
                margin-top: 15px;
            }
            
            /* Bättre läsbarhet på små skärmar */
            #match-notes {
                font-size: 14px;
                min-height: 80px;
            }
        }
        
        /* Extra små skärmar (iPhone SE etc.) */
        @media (max-width: 480px) {
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 3px 1px;
            }
            
            .score-input {
                width: 35px;
                font-size: 11px;
            }
            
            .round-note {
                font-size: 9px;
                min-height: 25px;
            }
            
            /* Gör tabellhuvuden mer kompakta */
            th {
                font-size: 10px;
                padding: 5px 2px;
            }
            
            /* Stack team information vertically */
            .team {
                padding: 10px;
            }
            
            .team input {
                margin-top: 3px;
                padding: 6px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>Petanque Matchprotokoll</h1>
    
    <div class="match-info">
        <div style="display: flex; justify-content: space-between; flex-wrap: wrap;">
            <div>
                <label>Datum:</label>
                <input type="date" id="match-date">
            </div>
            <div>
                <label>Plats:</label>
                <input type="text" id="match-location">
            </div>
            <div>
                <label>Typ av match:</label>
                <select id="match-type">
                    <option value="träning">Träning</option>
                    <option value="tävling">Tävling</option>
                    <option value="cup">Cup</option>
                    <option value="serie">Serie</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="team-section">
        <div class="team">
            <h3>Lag 1</h3>
            <div>
                <label>Lag Namn:</label>
                <input type="text" id="team1-name">
            </div>
            <div style="margin-top: 10px;">
                <label>Spelare:</label>
                <input type="text" id="team1-player1" placeholder="Spelare 1">
                <input type="text" id="team1-player2" placeholder="Spelare 2" style="margin-top: 5px;">
                <input type="text" id="team1-player3" placeholder="Spelare 3" style="margin-top: 5px;">
            </div>
        </div>
        
        <div class="team">
            <h3>Lag 2</h3>
            <div>
                <label>Lag Namn:</label>
                <input type="text" id="team2-name">
            </div>
            <div style="margin-top: 10px;">
                <label>Spelare:</label>
                <input type="text" id="team2-player1" placeholder="Spelare 1">
                <input type="text" id="team2-player2" placeholder="Spelare 2" style="margin-top: 5px;">
                <input type="text" id="team2-player3" placeholder="Spelare 3" style="margin-top: 5px;">
            </div>
        </div>
    </div>
    
    <h3>Poängfördelning</h3>
    <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
        <strong>Instruktion:</strong> Fyll i poängen som varje lag fick i just den omgången. Systemet räknar automatiskt ut totalen.
        <br><em>Exempel: Om lag 1 fick 1 poäng i omgång 1 och 3 poäng i omgång 2, så har de totalt 4 poäng.</em>
    </div>
    <table id="score-table">
        <thead>
            <tr>
                <th>Omgång</th>
                <th id="team1-header">Lag 1</th>
                <th id="team2-header">Lag 2</th>
                <th>Notis om omgången</th>
            </tr>
        </thead>
         <tbody>
            <tr>
                <td>1</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="1"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="1"></td>
                <td><input type="text" class="round-note" data-round="1" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>2</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="2"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="2"></td>
                <td><input type="text" class="round-note" data-round="2" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>3</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="3"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="3"></td>
                <td><input type="text" class="round-note" data-round="3" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>4</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="4"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="4"></td>
                <td><input type="text" class="round-note" data-round="4" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>5</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="5"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="5"></td>
                <td><input type="text" class="round-note" data-round="5" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>6</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="6"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="6"></td>
                <td><input type="text" class="round-note" data-round="6" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>7</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="7"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="7"></td>
                <td><input type="text" class="round-note" data-round="7" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>8</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="8"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="8"></td>
                <td><input type="text" class="round-note" data-round="8" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>9</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="9"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="9"></td>
                <td><input type="text" class="round-note" data-round="9" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>10</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="10"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="10"></td>
                <td><input type="text" class="round-note" data-round="10" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>11</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="11"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="11"></td>
                <td><input type="text" class="round-note" data-round="11" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>12</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="12"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="12"></td>
                <td><input type="text" class="round-note" data-round="12" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
            <tr>
                <td>13</td>
                <td><input type="number" min="0" class="score-input" data-team="1" data-round="13"></td>
                <td><input type="number" min="0" class="score-input" data-team="2" data-round="13"></td>
                <td><input type="text" class="round-note" data-round="13" placeholder="T.ex. bra kast, nära målet..."></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <th>Totalt</th>
                <th id="team1-total">0</th>
                <th id="team2-total">0</th>
                <th id="match-winner">-</th>
            </tr>
        </tfoot>
    </table>
    
    <div class="save-section">
        <h3>💾 Spara Match</h3>
        <p>Spara denna match i telefonens minne för att komma åt den senare.</p>
        <div class="save-buttons">
            <button id="save-match-btn" class="save-btn">Spara Match</button>
            <button id="auto-save-btn" class="save-btn">Auto-spara: AV</button>
        </div>
    </div>
    
    <div class="saved-matches" id="saved-matches-section" style="display: none;">
        <h3>📱 Sparade Matcher</h3>
        <div id="saved-matches-list"></div>
        <button id="clear-all-btn" class="delete-btn" style="margin-top: 10px;">Rensa Alla Sparade Matcher</button>
    </div>
    
    <div class="summary">
        <h3>Matchsammanfattning</h3>
        <div>
            <label>Antal omgångar:</label>
            <span id="rounds-played">0</span>
        </div>
        <div>
            <label>Vinnande lag:</label>
            <span id="final-winner">-</span>
        </div>
        <div>
            <label>Noteringar:</label><br>
            <textarea id="match-notes" rows="4" style="width: 100%; margin-top: 5px;" placeholder="Skriv ner viktiga händelser, observationer, etc."></textarea>
        </div>
    </div>
    
    <button id="print-btn">Skriv ut protokoll</button>
    <button id="reset-btn">Återställ formulär</button>
    <button id="show-saved-btn">Visa Sparade Matcher</button>

    <script>
        // Globala variabler för sparfunktioner
        let autoSaveEnabled = false;
        let autoSaveInterval;
        
        // Sparfunktioner
        function saveMatchData(matchName = null) {
            const matchData = {
                date: document.getElementById('match-date').value,
                location: document.getElementById('match-location').value,
                matchType: document.getElementById('match-type').value,
                team1Name: document.getElementById('team1-name').value,
                team1Player1: document.getElementById('team1-player1').value,
                team1Player2: document.getElementById('team1-player2').value,
                team1Player3: document.getElementById('team1-player3').value,
                team2Name: document.getElementById('team2-name').value,
                team2Player1: document.getElementById('team2-player1').value,
                team2Player2: document.getElementById('team2-player2').value,
                team2Player3: document.getElementById('team2-player3').value,
                scores: {},
                notes: {},
                matchNotes: document.getElementById('match-notes').value,
                savedAt: new Date().toISOString()
            };
            
            // Spara alla poäng och notiser
            for (let i = 1; i <= 13; i++) {
                const team1Input = document.querySelector(`.score-input[data-team="1"][data-round="${i}"]`);
                const team2Input = document.querySelector(`.score-input[data-team="2"][data-round="${i}"]`);
                const noteInput = document.querySelector(`.round-note[data-round="${i}"]`);
                
                matchData.scores[`team1_round${i}`] = team1Input.value;
                matchData.scores[`team2_round${i}`] = team2Input.value;
                matchData.notes[`round${i}`] = noteInput.value;
            }
            
            // Generera matchnamn om inget angivet
            if (!matchName) {
                const team1 = matchData.team1Name || 'Lag1';
                const team2 = matchData.team2Name || 'Lag2';
                const date = matchData.date || 'oklant-datum';
                matchName = `${team1} vs ${team2} (${date})`;
            }
            
            // Hämta befintliga sparade matcher
            const savedMatches = JSON.parse(localStorage.getItem('petanqueMatches') || '{}');
            savedMatches[matchName] = matchData;
            
            // Spara till localStorage
            localStorage.setItem('petanqueMatches', JSON.stringify(savedMatches));
            
            alert(`Match "${matchName}" sparad!`);
            updateSavedMatchesList();
        }
        
        function loadMatchData(matchName) {
            const savedMatches = JSON.parse(localStorage.getItem('petanqueMatches') || '{}');
            const matchData = savedMatches[matchName];
            
            if (!matchData) {
                alert('Match hittades inte!');
                return;
            }
            
            // Ladda grundläggande information
            document.getElementById('match-date').value = matchData.date || '';
            document.getElementById('match-location').value = matchData.location || '';
            document.getElementById('match-type').value = matchData.matchType || 'träning';
            document.getElementById('team1-name').value = matchData.team1Name || '';
            document.getElementById('team1-player1').value = matchData.team1Player1 || '';
            document.getElementById('team1-player2').value = matchData.team1Player2 || '';
            document.getElementById('team1-player3').value = matchData.team1Player3 || '';
            document.getElementById('team2-name').value = matchData.team2Name || '';
            document.getElementById('team2-player1').value = matchData.team2Player1 || '';
            document.getElementById('team2-player2').value = matchData.team2Player2 || '';
            document.getElementById('team2-player3').value = matchData.team2Player3 || '';
            document.getElementById('match-notes').value = matchData.matchNotes || '';
            
            // Ladda poäng och notiser
            for (let i = 1; i <= 13; i++) {
                const team1Input = document.querySelector(`.score-input[data-team="1"][data-round="${i}"]`);
                const team2Input = document.querySelector(`.score-input[data-team="2"][data-round="${i}"]`);
                const noteInput = document.querySelector(`.round-note[data-round="${i}"]`);
                
                team1Input.value = matchData.scores[`team1_round${i}`] || '';
                team2Input.value = matchData.scores[`team2_round${i}`] || '';
                noteInput.value = matchData.notes[`round${i}`] || '';
            }
            
            // Uppdatera headers och poäng
            updateHeaders();
            updateScores();
            
            alert(`Match "${matchName}" laddad!`);
        }
        
        function deleteMatchData(matchName) {
            if (!confirm(`Är du säker på att du vill radera "${matchName}"?`)) {
                return;
            }
            
            const savedMatches = JSON.parse(localStorage.getItem('petanqueMatches') || '{}');
            delete savedMatches[matchName];
            localStorage.setItem('petanqueMatches', JSON.stringify(savedMatches));
            
            updateSavedMatchesList();
            alert(`Match "${matchName}" raderad!`);
        }
        
        function updateSavedMatchesList() {
            const savedMatches = JSON.parse(localStorage.getItem('petanqueMatches') || '{}');
            const listContainer = document.getElementById('saved-matches-list');
            const section = document.getElementById('saved-matches-section');
            
            listContainer.innerHTML = '';
            
            const matchNames = Object.keys(savedMatches);
            if (matchNames.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            
            matchNames.forEach(matchName => {
                const matchData = savedMatches[matchName];
                const matchDiv = document.createElement('div');
                matchDiv.className = 'match-item';
                
                const savedDate = new Date(matchData.savedAt).toLocaleString('sv-SE');
                
                matchDiv.innerHTML = `
                    <div class="match-info-text">
                        <strong>${matchName}</strong><br>
                        <small>Sparad: ${savedDate}</small>
                    </div>
                    <div class="match-actions">
                        <button class="small-btn load-btn" onclick="loadMatchData('${matchName}')">Ladda</button>
                        <button class="small-btn delete-btn" onclick="deleteMatchData('${matchName}')">Radera</button>
                    </div>
                `;
                
                listContainer.appendChild(matchDiv);
            });
        }
        
        function toggleAutoSave() {
            autoSaveEnabled = !autoSaveEnabled;
            const btn = document.getElementById('auto-save-btn');
            
            if (autoSaveEnabled) {
                btn.textContent = 'Auto-spara: PÅ';
                btn.style.backgroundColor = '#28a745';
                
                // Spara automatiskt var 30:e sekund
                autoSaveInterval = setInterval(() => {
                    const team1Name = document.getElementById('team1-name').value;
                    const team2Name = document.getElementById('team2-name').value;
                    if (team1Name || team2Name) {
                        saveMatchData('AUTO-SPARAD MATCH');
                    }
                }, 30000);
                
                alert('Auto-spara aktiverat! Sparar automatiskt var 30:e sekund.');
            } else {
                btn.textContent = 'Auto-spara: AV';
                btn.style.backgroundColor = '#2c5545';
                
                if (autoSaveInterval) {
                    clearInterval(autoSaveInterval);
                }
                
                alert('Auto-spara avstängt.');
            }
        }
        
        function clearAllMatches() {
            if (!confirm('Är du säker på att du vill radera ALLA sparade matcher? Detta kan inte ångras!')) {
                return;
            }
            
            localStorage.removeItem('petanqueMatches');
            updateSavedMatchesList();
            alert('Alla sparade matcher har raderats!');
        }
        // Globala funktioner som alltid är tillgängliga
        function updateHeaders() {
            const team1Name = document.getElementById('team1-name').value || 'Lag 1';
            const team2Name = document.getElementById('team2-name').value || 'Lag 2';
            
            document.getElementById('team1-header').textContent = team1Name;
            document.getElementById('team2-header').textContent = team2Name;
        }
        
        function updateScores() {
            let team1Total = 0;
            let team2Total = 0;
            let roundsPlayed = 0;
            
            console.log('updateScores called');
            
            // Beräkna totalpoäng för varje omgång
            for (let i = 1; i <= 13; i++) {
                const team1Input = document.querySelector(`.score-input[data-team="1"][data-round="${i}"]`);
                const team2Input = document.querySelector(`.score-input[data-team="2"][data-round="${i}"]`);
                
                const team1RoundScore = parseInt(team1Input.value) || 0;
                const team2RoundScore = parseInt(team2Input.value) || 0;
                
                console.log(`Omgång ${i}: Lag1=${team1RoundScore}, Lag2=${team2RoundScore}`);
                
                if (team1RoundScore > 0 || team2RoundScore > 0) {
                    roundsPlayed++;
                }
                
                team1Total += team1RoundScore;
                team2Total += team2RoundScore;
            }
            
            console.log(`Totaler: Lag1=${team1Total}, Lag2=${team2Total}`);
            
            // Uppdatera totalerna
            document.getElementById('team1-total').textContent = team1Total;
            document.getElementById('team2-total').textContent = team2Total;
            document.getElementById('rounds-played').textContent = roundsPlayed;
            
            // Bestäm matchvinnare
            const matchWinnerCell = document.getElementById('match-winner');
            const finalWinnerSpan = document.getElementById('final-winner');
            
            if (team1Total > team2Total) {
                matchWinnerCell.textContent = document.getElementById('team1-name').value || 'Lag 1';
                finalWinnerSpan.textContent = document.getElementById('team1-name').value || 'Lag 1';
            } else if (team2Total > team1Total) {
                matchWinnerCell.textContent = document.getElementById('team2-name').value || 'Lag 2';
                finalWinnerSpan.textContent = document.getElementById('team2-name').value || 'Lag 2';
            } else if (team1Total === 0 && team2Total === 0) {
                matchWinnerCell.textContent = '-';
                finalWinnerSpan.textContent = '-';
            } else {
                matchWinnerCell.textContent = 'Oavgjort';
                finalWinnerSpan.textContent = 'Oavgjort';
            }
        }
        
        function resetForm() {
            if(confirm('Är du säker på att du vill återställa formuläret? All data kommer att försvinna.')) {
                // Återställ alla inputs
                const allInputs = document.querySelectorAll('input, textarea, select');
                allInputs.forEach(input => {
                    if (input.type === 'date') {
                        input.valueAsDate = new Date();
                    } else if (input.type === 'text' || input.type === 'number') {
                        input.value = '';
                    } else if (input.tagName === 'SELECT') {
                        input.value = input.options[0].value;
                    } else if (input.tagName === 'TEXTAREA') {
                        input.value = '';
                    }
                });
                
                // Återställ visning
                document.getElementById('team1-total').textContent = '0';
                document.getElementById('team2-total').textContent = '0';
                document.getElementById('match-winner').textContent = '-';
                document.getElementById('final-winner').textContent = '-';
                document.getElementById('rounds-played').textContent = '0';
                document.getElementById('team1-header').textContent = 'Lag 1';
                document.getElementById('team2-header').textContent = 'Lag 2';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Sätt dagens datum som standard
            document.getElementById('match-date').valueAsDate = new Date();
            
            // Uppdatera lagheaders när namn ändras
            document.getElementById('team1-name').addEventListener('input', updateHeaders);
            document.getElementById('team2-name').addEventListener('input', updateHeaders);
            
            // Lägg till händelselyssnare för poänginmatning med event delegation
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('score-input')) {
                    console.log('Score input changed:', e.target.value);
                    updateScores();
                }
            });
            
            // Skriv ut funktion
            document.getElementById('print-btn').addEventListener('click', function() {
                window.print();
            });
            
            // Återställ formulär
            document.getElementById('reset-btn').addEventListener('click', resetForm);
            
            // Sparfunktioner
            document.getElementById('save-match-btn').addEventListener('click', function() {
                const team1Name = document.getElementById('team1-name').value;
                const team2Name = document.getElementById('team2-name').value;
                
                if (!team1Name && !team2Name) {
                    alert('Fyll i minst ett lagnamn innan du sparar!');
                    return;
                }
                
                const matchName = prompt('Ge matchen ett namn (lämna tomt för automatiskt namn):');
                if (matchName !== null) {  // Användaren klickade inte Cancel
                    saveMatchData(matchName || null);
                }
            });
            
            document.getElementById('auto-save-btn').addEventListener('click', toggleAutoSave);
            
            document.getElementById('show-saved-btn').addEventListener('click', function() {
                const section = document.getElementById('saved-matches-section');
                if (section.style.display === 'none') {
                    updateSavedMatchesList();
                    section.style.display = 'block';
                    this.textContent = 'Dölj Sparade Matcher';
                } else {
                    section.style.display = 'none';
                    this.textContent = 'Visa Sparade Matcher';
                }
            });
            
            document.getElementById('clear-all-btn').addEventListener('click', clearAllMatches);
            
            // Ladda sparade matcher vid start
            updateSavedMatchesList();
            
            // Initial uppdatering
            updateScores();
        });
    </script>
</body>
</html>
